# Fallback для поиска свободных слотов

## Описание

Если при поиске свободных слотов в YClients API не найдено доступных времен или произошла ошибка, система автоматически генерирует слоты на весь рабочий день.

## Как это работает

### 1. Нормальный режим
- Система запрашивает свободные слоты через YClients API
- Если слоты найдены - возвращает их
- Если слотов нет - переходит в fallback режим

### 2. Fallback режим
- Генерирует слоты на весь рабочий день
- Время работы: 9:00 - 18:00 (настраивается)
- Интервал между слотами: 30 минут (настраивается)
- Все слоты помечаются как `available: true`

## Настройка

### Переменные окружения

Добавьте в `.env` файл:

```env
# Время начала работы клиники (часы)
CLINIC_START_HOUR=9

# Время окончания работы клиники (часы)  
CLINIC_END_HOUR=18

# Интервал между слотами (минуты)
SLOT_INTERVAL_MINUTES=30
```

### Примеры конфигурации

**Стандартная клиника (9:00-18:00, каждые 30 минут):**
```env
CLINIC_START_HOUR=9
CLINIC_END_HOUR=18
SLOT_INTERVAL_MINUTES=30
```

**Клиника с расширенным графиком (8:00-20:00, каждые 15 минут):**
```env
CLINIC_START_HOUR=8
CLINIC_END_HOUR=20
SLOT_INTERVAL_MINUTES=15
```

**Клиника с коротким днем (10:00-16:00, каждый час):**
```env
CLINIC_START_HOUR=10
CLINIC_END_HOUR=16
SLOT_INTERVAL_MINUTES=60
```

## Формат сгенерированных слотов

```json
{
  "datetime": "2025-09-11 09:00",
  "date": "2025-09-11",
  "time": "09:00",
  "doctor": "Имя врача",
  "doctor_id": 123,
  "service_id": 456,
  "available": true,
  "generated": true
}
```

## Логирование

Система логирует:
- `"No available slots found, generating slots for the whole day"` - когда слотов нет
- `"API error, generating slots for the whole day as fallback"` - когда API вернул ошибку
- `"Generated X slots for the whole day (9:00-18:00, interval: 30min)"` - статистика генерации

## Преимущества

1. **Всегда есть слоты** - клиент никогда не увидит "нет свободного времени"
2. **Гибкая настройка** - можно настроить под любой график работы
3. **Fallback при ошибках** - система работает даже при проблемах с API
4. **Прозрачность** - сгенерированные слоты помечены флагом `generated`

## Ограничения

- Сгенерированные слоты не проверяются на реальную доступность
- При записи на сгенерированный слот может возникнуть конфликт
- Рекомендуется использовать только как fallback, а не основной способ

## Рекомендации

1. **Настройте реалистичное время работы** - не генерируйте слоты в нерабочее время
2. **Используйте разумный интервал** - 30 минут оптимально для большинства услуг
3. **Мониторьте логи** - следите за частотой использования fallback режима
4. **Проверяйте API** - если fallback используется часто, возможно есть проблема с YClients API
