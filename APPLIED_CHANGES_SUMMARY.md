# ‚úÖ –°–≤–æ–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `src/config/env.py`

#### –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã:
- `WS_CONNECT_TIMEOUT`: 15 ‚Üí **30** —Å–µ–∫—É–Ω–¥
- `WS_PING_INTERVAL`: 30 ‚Üí **45** —Å–µ–∫—É–Ω–¥  
- `WS_PING_TIMEOUT`: 15 ‚Üí **20** —Å–µ–∫—É–Ω–¥
- `WS_MAX_RETRIES`: 10 ‚Üí **15** –ø–æ–ø—ã—Ç–æ–∫
- `RESPONSE_TIMEOUT`: 10 ‚Üí **15** —Å–µ–∫—É–Ω–¥

#### –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
- `WS_POOL_SIZE`: 3 ‚Üí **5** —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `WS_MAX_USERS_PER_CONNECTION`: 20 ‚Üí **15** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

```python
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—á–∏—Å—Ç–∫–∞
WS_HEALTH_CHECK_INTERVAL: int = Field(300)    # 5 –º–∏–Ω—É—Ç
WS_CLEANUP_INTERVAL: int = Field(60)          # 1 –º–∏–Ω—É—Ç–∞  
WS_MAX_RESPONSE_MONITOR_TIME: int = Field(30) # 30 —Å–µ–∫—É–Ω–¥

# Circuit Breaker
WS_CB_FAILURE_THRESHOLD: int = Field(5)       # 5 –Ω–µ—É–¥–∞—á
WS_CB_RECOVERY_TIMEOUT: int = Field(300)      # 5 –º–∏–Ω—É—Ç

# –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
WS_ADAPTIVE_TIMEOUTS: bool = Field(True)      # –í–∫–ª—é—á–µ–Ω–æ
WS_BASE_PING_TIMEOUT: int = Field(15)         # 15 —Å–µ–∫—É–Ω–¥
WS_MAX_PING_TIMEOUT: int = Field(60)          # 60 —Å–µ–∫—É–Ω–¥
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### –í `src/realtime/client.py`:
- ‚úÖ Circuit breaker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `settings.WS_CB_FAILURE_THRESHOLD`
- ‚úÖ –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `settings.WS_CB_RECOVERY_TIMEOUT`
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `settings.WS_ADAPTIVE_TIMEOUTS`
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ response –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `settings.WS_MAX_RESPONSE_MONITOR_TIME`
- ‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `settings.WS_CLEANUP_INTERVAL`

#### –í `src/app.py`:
- ‚úÖ –§–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç settings

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã:
```python
if settings.WS_ADAPTIVE_TIMEOUTS:
    adaptive_timeout = min(
        settings.WS_BASE_PING_TIMEOUT * (1 + failures * 0.2), 
        settings.WS_MAX_PING_TIMEOUT
    )
```

### Circuit Breaker:
```python
if consecutive_failures >= settings.WS_CB_FAILURE_THRESHOLD:
    circuit_breaker_open = True
    # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ settings.WS_CB_RECOVERY_TIMEOUT —Å–µ–∫—É–Ω–¥
```

### –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—á–∏—Å—Ç–∫–∏:
```python
# –û—Å–Ω–æ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞: –∫–∞–∂–¥—ã–µ 5x –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (5 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
cleanup_interval = settings.WS_CLEANUP_INTERVAL * 5

# –ì–ª—É–±–æ–∫–∞—è –æ—á–∏—Å—Ç–∫–∞: –∫–∞–∂–¥—ã–µ 30x –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (30 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)  
deep_cleanup_interval = settings.WS_CLEANUP_INTERVAL * 30
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ú–µ–Ω—å—à–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –±–ª–∞–≥–æ–¥–∞—Ä—è —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–∞–º
- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (5 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ 3)
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —É—Å–ª–æ–≤–∏—è —Å–µ—Ç–∏

### üõ°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:
- Circuit breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö response

### üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ—Å—Ç—å:
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–ø–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ
- –ú–æ–∂–Ω–æ —Ç–æ–Ω–∫–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:
   - –°–æ–æ–±—â–µ–Ω–∏–π –æ circuit breaker
   - –ß–∞—Å—Ç–æ—Ç—ã –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π  
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
   - –í—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞

3. **–¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   ```env
   # –ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ - —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã
   WS_PING_TIMEOUT=30
   WS_MAX_PING_TIMEOUT=90
   
   # –ï—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —É–≤–µ–ª–∏—á–∏—Ç—å –ø—É–ª
   WS_POOL_SIZE=8
   WS_MAX_USERS_PER_CONNECTION=10
   ```

## ‚úÖ –°—Ç–∞—Ç—É—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ env.py
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏  
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–∏–Ω—Ç–µ—Ä–æ–º - –æ—à–∏–±–æ–∫ –Ω–µ—Ç
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**
